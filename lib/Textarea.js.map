{"version":3,"file":"Textarea.js","sources":["../src/ui/Popover.js","../src/ui/ViewOnlyText.js","../src/ui/Textarea.js"],"sourcesContent":["import PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport React, { Component } from 'react';\n\nconst getId = errorMessage => errorMessage && errorMessage.id;\n\nconst hasId = errorMessage => !!getId(errorMessage);\n\nconst errorChanged = (errorMessage, nextErrorMessage) => (\n  hasId(nextErrorMessage) && getId(errorMessage) !== getId(nextErrorMessage)\n);\n\nconst MarginX = 20;\n\nclass Popover extends Component {\n  constructor(props) {\n    super(props);\n\n    this.$parent = null;\n    this.$popover = null;\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.handleOnResize, { passive: true });\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.handleOnResize, {\n      passive: true,\n    });\n  }\n\n  handleOnResize = () => {\n    if (!this.$parent) return;\n\n    this.adjustPosition();\n  };\n\n  render() {\n    const { content, containerClassName, popoverClassName } = this.props;\n\n    const containerStyles = classNames(containerClassName, 'c-popover__container');\n    const popoverStyles = classNames(popoverClassName, 'c-popover');\n\n    return (\n      <div className={containerStyles}>\n        <div\n          ref={ref => {\n            this.$popover = ref;\n          }}\n          className={popoverStyles}\n        >\n          <div>{content}</div>\n        </div>\n      </div>\n    );\n  }\n\n  adjust($parent) {\n    this.$parent = $parent;\n\n    this.adjustPosition();\n  }\n\n  adjustPosition() {\n    const newLeft = this.calculateLeft();\n    const newMaxWidth = this.calculateMaxWidth();\n\n    window.requestAnimationFrame(() => {\n      if (!this.$popover) return;\n\n      this.$popover.style.left = `${newLeft}px`;\n      this.$popover.style.maxWidth = `${newMaxWidth}px`;\n\n      const newTop = this.calculateTop();\n      this.$popover.style.top = `${newTop}px`;\n    });\n  }\n\n  calculateTop() {\n    const { clientHeight } = this.$popover;\n\n    const midHeight = clientHeight / 2;\n    const parentHeight = this.$parent.clientHeight / 2;\n\n    return parentHeight - midHeight;\n  }\n\n  calculateLeft() {\n    const rect = this.$parent.getBoundingClientRect();\n\n    return rect.width;\n  }\n\n  calculateMaxWidth() {\n    const rect = this.$parent.getBoundingClientRect();\n\n    const bodyWidth = document.body.clientWidth;\n\n    return bodyWidth - rect.left - rect.width - MarginX;\n  }\n}\n\nconst getDisplayName = WrappedComponent =>\n  WrappedComponent.displayName || WrappedComponent.name || 'Component';\n\nexport const withPopover = WrappedComponent => {\n  /* eslint-disable-next-line react/no-multi-comp */\n  const wrapper = class extends Component {\n    constructor(props) {\n      super(props);\n\n      this.state = {\n        currentErrorMessage: props.errorMessage,\n        isPopoverDismissed: false,\n      };\n\n      this.$root = null;\n      this.$popover = null;\n    }\n\n    componentDidMount() {\n      this.positionPopover();\n    }\n\n    componentWillReceiveProps(nextProps) {\n      const { errorMessage: nextErrorMessage } = nextProps;\n      const { currentErrorMessage } = this.state;\n\n      if (!hasId(nextErrorMessage)) {\n        this.destroyPopover();\n      }\n\n      if (\n        errorChanged(currentErrorMessage, nextErrorMessage)\n      ) {\n        this.attachNewPopover(nextProps);\n      }\n    }\n\n    componentDidUpdate() {\n      this.positionPopover();\n    }\n\n    componentWillUnmount() {\n      this.destroyPopover();\n    }\n\n    handleOnChange = (...args) => {\n      const { onChange } = this.props;\n\n      this.destroyPopover();\n\n      onChange(...args);\n    };\n\n    render() {\n      const { wrapperClassName, ...passThroughProps } = this.props;\n      const { currentErrorMessage, isPopoverDismissed } = this.state;\n\n      const popover =\n        hasId(currentErrorMessage) && !isPopoverDismissed ? (\n          <Popover\n            ref={ref => {\n              this.$popover = ref;\n            }}\n            key={currentErrorMessage.id}\n            content={currentErrorMessage.text}\n          />\n        ) : null;\n\n      return (\n        <span className={`flex flex-auto ${wrapperClassName}`}>\n          {popover}\n          <span\n            className=\"c-popover__component-wrapper\"\n            ref={ref => {\n              this.$root = ref;\n            }}\n          >\n            <WrappedComponent\n              onChange={this.handleOnChange}\n              {...passThroughProps}\n            />\n          </span>\n        </span>\n      );\n    }\n\n    attachNewPopover(props) {\n      const { errorMessage } = props;\n\n      this.setState({\n        currentErrorMessage: errorMessage,\n        isPopoverDismissed: false,\n      });\n    }\n\n    destroyPopover() {\n      this.setState({ isPopoverDismissed: true });\n    }\n\n    positionPopover() {\n      let { currentErrorMessage, isPopoverDismissed } = this.state;\n\n      if (hasId(currentErrorMessage) && !isPopoverDismissed) {\n        this.$popover.adjust(this.$root);\n      }\n    }\n  };\n\n  wrapper.displayName = `WithPopover(${getDisplayName(WrappedComponent)})`;\n\n  wrapper.defaultProps = {\n    wrapperClassName: '',\n    errorMessage: {},\n    onChange: () => {},\n  };\n\n  wrapper.propTypes = {\n    errorMessage: PropTypes.shape({\n      id: PropTypes.string,\n      text: PropTypes.string,\n    }),\n    wrapperClassName: PropTypes.string,\n    onChange: PropTypes.func,\n  };\n\n  return wrapper;\n};\n\nPopover.displayName = 'Popover';\n\nPopover.propTypes = {\n  /** Popover's content */\n  content: PropTypes.string.isRequired,\n  /** Popover's container CSS class */\n  containerClassName: PropTypes.string,\n  /** Popover's CSS class */\n  popoverClassName: PropTypes.string,\n};\n\nPopover.defaultProps = {\n  containerClassName: '',\n  popoverClassName: '',\n};\n\nexport default Popover;\n","import classNames from 'classnames';\nimport PropTypes from 'prop-types';\nimport React from 'react';\n\nconst isEmpty = value => value === null || value === undefined || Number.isNaN(value) || value === '';\n\nconst ViewOnlyText = ({ value }) => {\n  const className = classNames({\n    'gray-secondary': isEmpty(value),\n  });\n\n  const text = isEmpty(value) ? 'N/A' : value;\n\n  return <div className={className}>{text}</div>;\n};\n\nViewOnlyText.displayName = 'ViewOnlyText';\n\nViewOnlyText.defaultProps = {\n  value: null,\n};\n\nViewOnlyText.propTypes = {\n  /** Text value */\n  value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n};\n\nexport default ViewOnlyText;\n","import classNames from 'classnames';\nimport PropTypes from 'prop-types';\nimport React, { Component } from 'react';\nimport { withPopover } from './Popover';\n\nimport ViewOnlyText from './ViewOnlyText';\n\nexport class Textarea extends Component {\n  handleOnChange = e => {\n    const { target: { value } } = e;\n    const { validRegex, onChange } = this.props;\n\n    if (!validRegex || value.match(validRegex) !== null) {\n      onChange(value);\n    }\n  };\n\n  handleOnKeyDown = e => {\n    const { onSubmit } = this.props;\n\n    const { key, target: { value } } = e;\n\n    if (key === 'Enter') {\n      onSubmit(value);\n    }\n  };\n\n  render() {\n    const {\n      placeholder,\n      className,\n      inputRef,\n      maxLength,\n      value,\n      viewOnly,\n      autoFocus,\n      showLimit,\n      limitClassName,\n      containerClassName,\n    } = this.props;\n\n    if (viewOnly) {\n      return this.renderAsViewOnly();\n    }\n\n    const textAreaClassName = classNames('textarea', className);\n\n    return (\n      <div className={classNames('full-width', containerClassName)}>\n        <textarea\n          ref={inputRef}\n          className={textAreaClassName}\n          maxLength={maxLength}\n          placeholder={placeholder}\n          value={value || ''}\n          autoFocus={autoFocus}\n          onChange={this.handleOnChange}\n          onKeyDown={this.handleOnKeyDown}\n        />\n        {maxLength && !viewOnly && showLimit && (\n          <div className=\"flex justify-end\">\n            <span className={limitClassName}>{maxLength - value.length} characters remaining</span>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  renderAsViewOnly() {\n    const { value } = this.props;\n\n    return <ViewOnlyText value={value} />;\n  }\n}\n\nTextarea.displayName = 'Textarea';\n\nTextarea.defaultProps = {\n  className: '',\n  containerClassName: '',\n  limitClassName: 'fs-12 red p1/2',\n  maxLength: 120,\n  placeholder: '',\n  value: '',\n  validRegex: null,\n  viewOnly: false,\n  autoFocus: false,\n  showLimit: false,\n  inputRef: () => {},\n  onChange: () => {},\n  onSubmit: () => {},\n};\n\nTextarea.propTypes = {\n  /** CSS class to customize the component */\n  className: PropTypes.string,\n  /** CSS class to customize the container component */\n  containerClassName: PropTypes.string,\n  /** CSS class to customize the limit counter */\n  limitClassName: PropTypes.string,\n  /** Reference to be handled from parent */\n  inputRef: PropTypes.func,\n  /** Maximum characters count */\n  maxLength: PropTypes.number,\n  /** Placeholder text */\n  placeholder: PropTypes.string,\n  /** Text value */\n  value: PropTypes.string,\n  /** Regex to be satisfied */\n  validRegex: PropTypes.object,\n  /** Disables edition */\n  viewOnly: PropTypes.bool,\n  /** onChange textarea's handler */\n  onChange: PropTypes.func,\n  /** onSubmit textarea's handler */\n  onSubmit: PropTypes.func,\n  /** Enables auto focus */\n  autoFocus: PropTypes.bool,\n  /** Enables limit counter for number of characters */\n  showLimit: PropTypes.bool,\n};\n\nconst TextareaWithPopover = withPopover(Textarea);\nTextareaWithPopover.displayName = 'Textarea';\n\nexport default TextareaWithPopover;\n"],"names":["getId","errorMessage","id","hasId","errorChanged","nextErrorMessage","MarginX","Popover","props","handleOnResize","_this","$parent","adjustPosition","$popover","Component","addEventListener","this","passive","removeEventListener","content","containerClassName","popoverClassName","containerStyles","classNames","popoverStyles","React","className","ref","newLeft","calculateLeft","newMaxWidth","calculateMaxWidth","requestAnimationFrame","_this3","style","left","maxWidth","newTop","calculateTop","top","midHeight","clientHeight","getBoundingClientRect","width","rect","document","body","clientWidth","getDisplayName","WrappedComponent","displayName","name","withPopover","wrapper","handleOnChange","onChange","_this4","destroyPopover","state","$root","positionPopover","nextProps","currentErrorMessage","attachNewPopover","wrapperClassName","passThroughProps","isPopoverDismissed","popover","text","setState","adjust","defaultProps","propTypes","PropTypes","shape","string","func","isRequired","isEmpty","value","undefined","Number","isNaN","ViewOnlyText","oneOfType","number","Textarea","e","target","validRegex","match","handleOnKeyDown","onSubmit","key","placeholder","inputRef","maxLength","viewOnly","autoFocus","showLimit","limitClassName","renderAsViewOnly","textAreaClassName","length","object","bool","TextareaWithPopover"],"mappings":"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"}